{% if request.page_type == 'product' %}
<script>
  document.addEventListener("DOMContentLoaded", function() {
    // 1. Get the current product ID
    const currentProductId = "gid://shopify/Product/{{ product.id }}";
    
    // 2. Fetch the FAQs (Update this URL to your live/Vercel URL)
    const apiUrl = `https://shopify-theme-xi.vercel.app/api/faqs?productId=${encodeURIComponent(currentProductId)}`; 

    fetch(apiUrl)
      .then(response => response.json())
      .then(data => {
        // 3. If no FAQs exist for this product, do nothing
        if (Object.keys(data).length === 0) return;

        // 4. Build the HTML for the FAQs
        let faqHtml = `
          <div class="custom-faq-wrapper" style="max-width: 800px; margin: 40px auto; padding: 20px; clear: both;">
            <h2 style="text-align: center; margin-bottom: 20px;">Frequently Asked Questions</h2>
        `;

        for (const [title, questions] of Object.entries(data)) {
          faqHtml += `<div style="margin-bottom: 20px;">
                        <h3 style="margin-bottom: 10px; border-bottom: 1px solid #ccc; padding-bottom: 5px;">${title}</h3>`;
          
          questions.forEach(q => {
            faqHtml += `<details style="margin-bottom: 10px; background: #f9f9f9; padding: 10px; border-radius: 5px;">
                          <summary style="font-weight: bold; cursor: pointer;">${q.question}</summary>
                          <p style="margin-top: 10px; color: #555;">${q.answer}</p>
                        </details>`;
          });
          faqHtml += `</div>`;
        }
        faqHtml += `</div>`;

        // 5. Inject the HTML into the page automatically
        // This looks for standard Shopify product containers to attach to.
        const productInfoContainer = document.querySelector('.product__info-wrapper') || 
                                     document.querySelector('.product-single__meta') || 
                                     document.querySelector('main');
        
        if (productInfoContainer) {
          // Injects the FAQ block right after the product info container
          productInfoContainer.insertAdjacentHTML('afterend', faqHtml);
        }
      })
      .catch(error => console.error("Error loading FAQs:", error));
  });
</script>
{% endif %}

{% schema %}
{
  "name": "Auto FAQ Injector",
  "target": "body",
  "settings": []
}
{% endschema %}