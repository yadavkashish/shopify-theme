{% if request.page_type == 'product' %}

<div id="faq-app-root"></div>

<style>
  /* Base Container */
  .faq-app-section {
    padding: 60px 0;
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    font-family: inherit;
  }
  .faq-app-title { text-align: center; margin-bottom: 40px; }

  /* --- STYLE: ACCORDION --- */
  .faq-style-accordion .faq-item {
    border: 1px solid #e1e3e5;
    margin-bottom: 10px;
    background: white;
    overflow: hidden;
  }
  .faq-style-accordion summary {
    padding: 15px;
    cursor: pointer;
    font-weight: 600;
    display: flex;
    justify-content: space-between;
    align-items: center;
    list-style: none;
  }
  .faq-style-accordion summary::-webkit-details-marker { display: none; }
  .faq-style-accordion .faq-answer {
    padding: 0 15px 15px;
    color: #555;
    line-height: 1.6;
  }

  /* --- STYLE: GRID --- */
  .faq-style-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
  }
  .faq-style-grid .faq-card {
    padding: 20px;
    border: 1px solid #e1e3e5;
    background: white;
    border-top-width: 4px; /* Color set by JS */
    border-top-style: solid;
  }

  /* --- STYLE: MINIMAL --- */
  .faq-style-minimal .faq-item {
    border-bottom: 1px solid #e1e3e5;
    padding: 20px 0;
  }
  .faq-style-minimal h3 { margin: 0 0 5px 0; font-size: 16px; }
  .faq-style-minimal p { margin: 0; color: #666; }

  /* --- STYLE: CHAT --- */
  .faq-style-chat {
    background: #f9fafb;
    border: 1px solid #e1e3e5;
    max-width: 600px;
    margin: 0 auto;
    overflow: hidden;
  }
  .faq-chat-header {
    padding: 15px;
    background: white;
    border-bottom: 1px solid #e1e3e5;
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 600;
  }
  .faq-chat-body { padding: 20px; display: flex; flex-direction: column; gap: 15px; }
  .faq-bubble-bot {
    align-self: flex-start;
    background: white;
    padding: 12px 16px;
    border-radius: 0 15px 15px 15px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
  }
  .faq-bubble-user {
    align-self: flex-end;
    padding: 10px 16px;
    border-radius: 15px 15px 0 15px;
    border: 1px solid; /* Color set by JS */
    cursor: pointer;
    background: rgba(255,255,255,0.5);
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const currentProductId = "gid://shopify/Product/{{ product.id }}";
    const shopDomain = "{{ shop.permanent_domain }}";
    
    // Pass shop domain to get specific settings
    const apiUrl = `https://themee-xi.vercel.app/api/faqs?productId=${encodeURIComponent(currentProductId)}&shop=${encodeURIComponent(shopDomain)}`;

    fetch(apiUrl)
      .then(res => res.json())
      .then(data => {
        // Data format: { content: { "Title": [..] }, config: { style: "grid", color: "...", radius: 8 } }
        if (!data.content || Object.keys(data.content).length === 0) return;

        const config = data.config || { style: 'accordion', color: '#008060', radius: 8 };
        const faqs = Object.values(data.content).flat(); // Flatten groups for simple layouts

        const root = document.getElementById('faq-app-root');
        let html = `<div class="faq-app-section">`;

        // --- RENDER LOGIC BASED ON STYLE ---

        // 1. ACCORDION
        if (config.style === 'accordion') {
           html += `<h2 class="faq-app-title">Frequently Asked Questions</h2>
                    <div class="faq-style-accordion" style="display:flex; flex-direction:column; gap:10px;">`;
           faqs.forEach(f => {
             html += `
               <details class="faq-item" style="border-radius:${config.radius}px;">
                 <summary>
                   <span>${f.question}</span>
                   <span style="color:${config.color}">â–¼</span>
                 </summary>
                 <div class="faq-answer">${f.answer}</div>
               </details>`;
           });
           html += `</div>`;
        }

        // 2. GRID (Bento)
        else if (config.style === 'grid') {
           html += `<h2 class="faq-app-title">Frequently Asked Questions</h2>
                    <div class="faq-style-grid">`;
           faqs.forEach(f => {
             html += `
               <div class="faq-card" style="border-radius:${config.radius}px; border-top-color:${config.color};">
                 <h3 style="margin:0 0 10px 0; font-weight:bold;">${f.question}</h3>
                 <p style="margin:0; color:#666; line-height:1.4;">${f.answer}</p>
               </div>`;
           });
           html += `</div>`;
        }

        // 3. MINIMAL
        else if (config.style === 'minimal') {
           html += `<h2 class="faq-app-title">Frequently Asked Questions</h2>
                    <div class="faq-style-minimal" style="border-top:1px solid #e1e3e5;">`;
           faqs.forEach(f => {
             html += `
               <div class="faq-item">
                 <h3>${f.question}</h3>
                 <p>${f.answer}</p>
                 <div style="color:${config.color}; font-size:20px; line-height:1; margin-top:5px;">+</div>
               </div>`;
           });
           html += `</div>`;
        }

        // 4. CHAT BOT
        else if (config.style === 'chat') {
           html += `
             <div class="faq-style-chat" style="border-radius:${config.radius}px;">
               <div class="faq-chat-header">
                 <div style="width:30px; height:30px; border-radius:50%; background:${config.color}; color:white; display:flex; align-items:center; justify-content:center; font-size:12px;">AI</div>
                 <span>Support Bot</span>
               </div>
               <div class="faq-chat-body">
                 <div class="faq-bubble-bot">How can I help you today?</div>
                 ${faqs.map(f => `
                   <div class="faq-bubble-user" style="color:${config.color}; border-color:${config.color};">
                     ${f.question}
                   </div>
                 `).join('')}
               </div>
             </div>
           `;
        }

        html += `</div>`;
        root.innerHTML = html;
        
        // Optional: Add interactivity for Chat bubbles if needed (e.g., clicking expands answer)
        if(config.style === 'chat') {
          // You would add click listeners here to simulate chat response
        }

      })
      .catch(e => console.error("FAQ Load Error", e));
  });
</script>
{% endif %}

{% schema %}
{
  "name": "Auto FAQ Injector",
  "target": "section",
  "settings": []
}
{% endschema %}